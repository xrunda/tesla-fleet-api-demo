# OpenClaw + 飞书控制特斯拉执行任务

目标：在飞书中的 OpenClaw 稳定、安全地控制 Tesla（基于当前已部署在阿里云 K8s 的服务）。

---

## 阶段 0：目标冻结（D1 上午）

- [ ] 确认第一批上线命令：`auto_conditioning_start`、`auto_conditioning_stop`、`door_lock`、`door_unlock`
- [ ] 定义交互方式：自然语言 + 按钮确认
- [ ] 定义验收标准（成功率、延迟、风控）

## 阶段 1：架构定稿（D1 下午）

- [ ] 明确调用链路：飞书 -> OpenClaw -> Tesla 控制服务 -> Tesla API/Command Proxy
- [ ] 明确权限边界：OpenClaw 做意图，服务端做最终鉴权
- [ ] 明确日志链路：请求 ID 贯穿全链路

## 阶段 2：服务接口标准化（D2）

- [ ] 新增机器人专用接口：`POST /bot/tesla/command`
- [ ] 统一请求结构：`command`、`vehicle_id`、`payload`、`requester`、`request_id`
- [ ] 增加命令白名单与参数校验
- [ ] 统一返回结构：`ok/error` + 可读错误原因

## 阶段 3：OpenClaw 工具接入（D3）

- [ ] 在 OpenClaw 注册工具：`tesla_command_execute`
- [ ] 做中文意图映射（如“开空调”-> `auto_conditioning_start`）
- [ ] 对高风险命令改为“确认后执行”

## 阶段 4：飞书体验优化（D4 上午）

- [ ] 指令执行前卡片：车辆、命令、风险等级、确认按钮
- [ ] 执行后反馈卡片：成功/失败、失败原因、重试建议
- [ ] 增加常用快捷词：开空调、关空调、锁车、解锁

## 阶段 5：安全与风控（D4 下午）

- [ ] OpenClaw -> 服务端使用独立 API Token
- [ ] 用户权限映射（谁可执行哪些命令）
- [ ] 高风险命令二次确认（PIN、清除数据、代客模式等）
- [ ] 审计日志落盘：谁在什么时候执行了什么

## 阶段 6：联调与灰度（D5）

- [ ] 通过 20+ 条联调用例（成功、参数错误、车辆离线、proxy 异常）
- [ ] 灰度给单一账号先用
- [ ] 观察 2-3 天失败原因 TopN，修复后再扩容

---

## 里程碑与验收

### M1（本周）
- [ ] 飞书中完成 4 个核心命令闭环（开关空调、锁/解锁）

### M2（下周）
- [ ] 增加充电类命令（`charge_start`、`charge_stop`、`set_charge_limit`）
- [ ] 完成高风险命令风控策略上线

### M3（稳定期）
- [ ] 指令成功率 >= 95%
- [ ] 平均响应时间满足目标
- [ ] 关键失败场景有自动提示与回滚策略
